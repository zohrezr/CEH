$\color{#b91646}{\textsf{idle}}$
=================================

![Uploading image.png…]()

**idle port scan using Fragmentation ID**

زمانی که یه سیستمی رو چک می کنی، اون سیستم متوجه کار شما می شه. -> برای حل این مشکل idle port scan درست شد.

توی این سناریو یه زامبی در نظر می گیریم. -> زامبی مغزش تحت کنترل یکی دیگه است. (مثل پرینتر).

## $\color{#105652}{\textsf{Open port}}$

### $\color{#25678D}{\textsf{step 1: Probe the zombie's IP ID}}$

مهاجم به پرینتر یه پکت SYN/ACK می فرسته. -> پکت بی ربط چون اصلا باهم SYN نکرده بودن.

پرنتر برای اینکه این مشکل رو حل کنه یه RST به مهاجم می فرسته. RST یه **IP ID=31337** داره.

### $\color{#25678D}{\textsf{step 2:Forge a SYN packet "from" the zombie}}$

مهاجم یه پکت SYN درست می کنه (خودش همه چیزاشو مثل می تونه source تنظیم کنه). -> پکت SYN، پکت درست و عادی است.

توی پکتی که می سازه source رو پرینتر قرار میده -> یه پکت درست می کنه می گه این از زامبی اومده.

پکت SYN رو می فرسته برای قربانی.

قربانی جواب میده به زامبی و می گه SYN/ACK -> باشه وصل شو.

زامبی (از همه جا بی خبر) به قربانی RST می فرسته و می گه نمی خوام وصل شم. عدد RST رو یکی میبره بالاتر **IP ID=31338**

### $\color{#25678D}{\textsf{step 3:Probe the zombie's IP ID again}}$

مهاجم متوجه نمی شه که IP ID زامبی یکی بیشتر شده.

برای اینکه IP ID زامبی رو ببینه یه بار دیگه بهش SYN/ACK می فرسته و بعد دوباره زامبی RST می فرسته با **IP ID=31339**

مهاجم می بینه که IP ID زامبی دوتا اضافه شده پس این وسط یه پکت دیگه فرستاده => می فهمیم قربانی یکبار به زامبی جواب داده و زامبی جواب برگردونده =>**port مورد نظر واقعا باز بود.**
_______________________________
## $\color{#105652}{\textsf{Close port}}$

### $\color{#25678D}{\textsf{step 1: Probe the zombie's IP ID}}$

مهاجم به پرینتر یه پکت SYN/ACK می فرسته. -> پکت بی ربط چون اصلا باهم SYN نکرده بودن.

پرنتر برای اینکه این مشکل رو حل کنه یه RST به مهاجم می فرسته. RST یه **IP ID=31337** داره.

### $\color{#25678D}{\textsf{step 2:Forge a SYN packet "from" the zombie}}$

مهاجم یه پکت SYN درست می کنه (خودش همه چیزاشو مثل می تونه source تنظیم کنه). -> پکت SYN، پکت درست و عادی است.

توی پکتی که می سازه source رو پرینتر قرار میده -> یه پکت درست می کنه می گه این از زامبی اومده.

پکت SYN رو می فرسته برای قربانی.

قربانی یه پکت RST برای زامبی می فرسته.

چون زامبی RST گرفته نیازی نیست جوابی برگردونه. -> IP ID تغییر نمی کنه.

### $\color{#25678D}{\textsf{step 3:Probe the zombie's IP ID again}}$

مهاجم متوجه نمی شه که IP ID زامبی تغییر کرده یا نه.

برای اینکه IP ID زامبی رو ببینه یه بار دیگه بهش SYN/ACK می فرسته و بعد دوباره زامبی RST می فرسته با **IP ID=31338**

مهاجم می بینه که IP ID زامبی یه دونه اضافه شده پس این وسط یه پکت دیگه فرستاده نشده => می فهمیم قربانی پکت SYN رو که گرفته در پاسخ RST فرستاده =>**port مورد نظر بسته بود.**

## $\color{#105652}{\textsf{idle with nmap}}$

`#nmap -Pn -sI <zambi IP> <target> -p <port>`

- **-Pn** -> ping no

خیلی از اسکن های nmap اول یه ping می کنن. اگر قرار باشه به مهاجم ping بزنی همه چیز به فناست.

- **-sI** -> zammbi attack

با سوئیچ s نوع attack رو مشخص می کنیم.

اینکه زامبی هم چه port هاییش بازه مهمه باید تنظیم بشه طبق چیزی که می خوایم مثلا port های موردنظرمون باز باشه.

`#nmap -Pn -sI <zombie IP> <target> -p <port> --packet-trace`

- **--packet-trace**

می تونیم ببینیم برای packetمون چه اتفاقی می افته.
